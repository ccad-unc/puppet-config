#####################################################################
# NTPD configuration file
#####################################################################
# NOTE: This file is automatically generated by puppet.
# Changes to this file will be overwritten periodically by puppet!
#####################################################################
# TEMPLATE: {<%= @name %>}/<%= File.basename(__FILE__) %>} 
#####################################################################
<% ntp_master = String.new -%>
<% ntp_slave = Array.new -%>

<% if @myroles.include?('ntpprimary') or @myroles.include?('ntpsecondary') -%>
  <%- ntp_master = scope.function_hiera(['time_commons_server_master']) if scope.function_hiera(['time_commons_server_master']) != nil -%>
  <%- ntp_slaves = scope.function_hiera(['time_commons_server_slaves']) if scope.function_hiera(['time_commons_server_slaves']) != nil -%>
  <%- ntp_server_options = scope.function_hiera(['time_commons_server_options']) -%>
<% else -%>
  <%- ntp_master = @whohastherole['ntpprimary'][0] if @whohastherole.has_key?("ntpprimary") -%>
  <%- ntp_slaves = @whohastherole['ntpsecondary'] if @whohastherole.has_key?("ntpsecondary") -%>
<% end -%>

<%= "server "+ntp_master.to_s+" prefer" if ntp_master.to_s.length > 0 %>
<% if ntp_slaves.length > 0 -%>
  <%- ntp_slaves.each do | srv | -%>
<%= "server "+srv.to_s if srv.to_s.length > 0 %> 
  <%- end -%>
<% end -%>

restrict -4 default kod notrap nomodify nopeer noquery
restrict -6 default kod notrap nomodify nopeer noquery
<%= ntp_server_options %>

driftfile /var/lib/ntp/ntp.drift
statsdir /var/log/ntpstats/

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

restrict 127.0.0.1
restrict ::1

disable auth

